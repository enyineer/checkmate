import { createClientDefinition, proc } from "@checkstack/common";
import { z } from "zod";
import {
  {{pluginNamePascal}}ItemSchema,
  Create{{pluginNamePascal}}ItemSchema,
  Update{{pluginNamePascal}}ItemSchema,
} from "./schemas";
import { {{pluginNameCamel}}Access } from "./access";
import { pluginMetadata } from "./plugin-metadata";

export const {{pluginNameCamel}}Contract = {
  // List all items - requires authenticated user with read access
  getItems: proc({
    operationType: "query",
    userType: "user",
    access: [{{pluginNameCamel}}Access.read],
  }).output(z.array({{pluginNamePascal}}ItemSchema)),

  // Get single item
  getItem: proc({
    operationType: "query",
    userType: "user",
    access: [{{pluginNameCamel}}Access.read],
  })
    .input(z.object({ id: z.string() }))
    .output({{pluginNamePascal}}ItemSchema),

  // Create item
  createItem: proc({
    operationType: "mutation",
    userType: "user",
    access: [{{pluginNameCamel}}Access.manage],
  })
    .input(Create{{pluginNamePascal}}ItemSchema)
    .output({{pluginNamePascal}}ItemSchema),

  // Update item
  updateItem: proc({
    operationType: "mutation",
    userType: "user",
    access: [{{pluginNameCamel}}Access.manage],
  })
    .input(
      z.object({
        id: z.string(),
        data: Update{{pluginNamePascal}}ItemSchema,
      })
    )
    .output({{pluginNamePascal}}ItemSchema),

  // Delete item
  deleteItem: proc({
    operationType: "mutation",
    userType: "user",
    access: [{{pluginNameCamel}}Access.manage],
  })
    .input(z.object({ id: z.string() }))
    .output(z.void()),
};

// Export contract type
export type {{pluginNamePascal}}Contract = typeof {{pluginNameCamel}}Contract;

// Export client definition for type-safe usePluginClient usage
// Frontend: const client = usePluginClient({{pluginNamePascal}}Api);
// Backend:  const client = rpcClient.forPlugin({{pluginNamePascal}}Api);
export const {{pluginNamePascal}}Api = createClientDefinition(
  {{pluginNameCamel}}Contract,
  pluginMetadata
);
